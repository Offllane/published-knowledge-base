Куки – это небольшие строки данных, которые хранятся непосредственно в браузере. Они являются частью HTTP-протокола.
Куки обычно устанавливаются веб-сервером при помощи заголовка `Set-Cookie`. Затем браузер будет автоматически добавлять их в (почти) каждый запрос на тот же домен при помощи заголовка `Cookie`.

### Для чего нужны cookie?
Один из наиболее частых случаев использования куки – это аутентификация:

1. При входе на сайт сервер отсылает в ответ HTTP-заголовок `Set-Cookie` для того, чтобы установить куки со специальным уникальным идентификатором сессии («session identifier»).
2. Во время следующего запроса к этому же домену браузер посылает на сервер HTTP-заголовок `Cookie`.
3. Таким образом, сервер понимает, кто сделал запрос.

Часто в Cookie файлах хранится статистика посещений, логин и пароль от сайтов или сервисов, индивидуальные настройки пользователя (регион, дизайн оформления и прочее).

### Чтение cookie
```js
alert(document.cookie); // cookie1=value1; cookie2=value2;...
```
Значение `document.cookie` состоит из пар `ключ=значение`, разделённых `;`. Каждая пара представляет собой отдельное куки.

Чтобы найти определённое куки, достаточно разбить строку из `document.cookie` по `;`, и затем найти нужный ключ. Для этого мы можем использовать как регулярные выражения, так и функции для обработки массивов.

### Запись cookie
Мы можем писать в `document.cookie`. Но это не просто свойство данных, а акcессор (геттер/сеттер). Присваивание к нему обрабатывается особым образом.

**Запись в `document.cookie` обновит только упомянутые в ней куки, но при этом не затронет все остальные.**

Например, этот вызов установит куки с именем `user` и значением `John`:
```js
document.cookie = "user=John"; // обновляем только куки с именем 'user'
```

Технически, и имя и значение куки могут состоять из любых символов, для правильного форматирования следует использовать встроенную функцию `encodeURIComponent`:
```js
// специальные символы (пробелы), требуется кодирование
let name = "my name";
let value = "John Smith"

// кодирует в my%20name=John%20Smith
document.cookie = encodeURIComponent(name) + '=' + encodeURIComponent(value);
```

### Ограничения
>[!error] Ограничения
>- После `encodeURIComponent` пара `name=value` не должна занимать более 4Кб. Таким образом, мы не можем хранить в куки большие данные.
>- Общее количество куки на один домен ограничивается примерно 20+. Точное ограничение зависит от конкретного браузера.

### Настройки куки
У куки есть ряд настроек, многие из которых важны и должны быть установлены.

Эти настройки указываются после пары `ключ=значение` и отделены друг от друга разделителем `;`, вот так:
```js
document.cookie = "user=John; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT"
```

1. `path`. По умолчанию устанавливается текущий путь, делает куки видимым только по указанному пути и ниже.
2. `domain`. По умолчанию устанавливается текущий путь, делает куки видимым только по указанному пути и ниже.
3. `expires, max-age`. Устанавливает дату истечения срока действия, без них куки умрёт при закрытии браузера.
4. `secure`. Делает куки доступным только при использовании HTTPS.
5. `samesite`. Запрещает браузеру отправлять куки с запросами, поступающими извне, помогает предотвратить XSRF-атаки.

### Читать также: 
[[LocalStorage, SessionStorage]]